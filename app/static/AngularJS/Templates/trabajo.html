<link href="../../css/inspinia/sweetalert/sweetalert.css" rel="stylesheet">
<div ng-init="init()" class="animated bounceInRight">
    <div class="headTitleTallerCita">
        <span class="title"> Órdenes de servicio <span class="subtitle">Call Center / Taller</span></span>
    </div>
    <div class="wrapper wrapper-content">
        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <tabset>
                            <tab heading="En proceso" index="0">
                                <br/>
                                <br/>
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover dataTableTrabajo" cg-busy="{promise:promise,message:message}">
                                        <thead>
                                            <tr>
                                                <th>Número económico</th>
                                                <th>TAR</th>
                                                <th>Marca</th>
                                                <th>Modelo</th>
                                                <th>Descripción</th>
                                                <th>Estatus</th>
                                                <th>Fecha</th>
                                                <th>Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="trabajo in trabajos">
                                                <td>{{trabajo.numEconomico}}</td>
                                                <td>{{trabajo.TAR}}</td>
                                                <td>{{trabajo.marca}}</td>
                                                <td>{{trabajo.modeloMarca}}</td>
                                                <td>{{trabajo.trabajo}}</td>
                                                <td ng-class="{'rowAzul': trabajo.estatus=='OrdenGarantia'}">{{trabajo.descripcionLarga}}</td>
                                                <td>{{trabajo.fecha | date:"dd-MM-yy HH:mm"}}</td>
                                                <td>
                                                    <button class="btn btn-info" type="button" ng-click="aprobarTrabajo(trabajo, 1)" data-toggle="tooltip" tooltip="Ver órden de servicio" tooltip-placement="up"><span class="glyphicon glyphicon-sunglasses"></span></button>

                                                    <button ng-if="trabajo.estatus == 'Iniciado' || trabajo.estatus == 'OrdenGarantia'" ng-hide="userData.idTipoUsuario == 4" class="btn btn-success" type="button" ng-click="openFinishingTrabajoModal(trabajo.idTrabajo)" data-toggle="tooltip" tooltip="Terminar trabajo" tooltip-placement="up"><span class="glyphicon glyphicon-wrench"></span>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </tab>
                            <tab heading="Entrega" index="1">
                                <br/>
                                <br/>
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover dataTableTrabajoTerminado" cg-busy="{promise:promise,message:message}">
                                        <thead>
                                            <tr>
                                                <th>Número económico</th>
                                                <th>TAR</th>
                                                <th>Marca</th>
                                                <th>Modelo</th>
                                                <th>Descripción</th>
                                                <th>Observaciones</th>
                                                <th>Estatus</th>
                                                <th>Fecha</th>
                                                <th>Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="trabajo in trabajosTerminados">
                                                <td>{{trabajo.numEconomico}}</td>
                                                <td>{{trabajo.TAR}}</td>
                                                <td>{{trabajo.marca}}</td>
                                                <td>{{trabajo.modeloMarca}}</td>
                                                <td>{{trabajo.trabajo}}</td>
                                                <td>{{trabajo.observacion}}</td>
                                                <td>{{trabajo.descripcionLarga}}</td>
                                                <td>{{trabajo.fechaFin | date:"dd-MM-yy HH:mm"}}</td>
                                                <td>
                                                    <button class="btn btn-info" type="button" ng-click="aprobarTrabajo(trabajo, 1)" data-toggle="tooltip" tooltip="Ver órden de servicio" tooltip-placement="up"><span class="glyphicon glyphicon-sunglasses"></span></button>

                                                    <button ng-if="trabajo.estatus == 'Terminado'" ng-hide="userData.idTipoUsuario == 4" class="btn btn-primary" type="button" ng-click="adjuntar(trabajo.idTrabajo,2)" data-toggle="tooltip" tooltip="Cargar hoja de transferencia de custodia" tooltip-placement="left"><span class="glyphicon glyphicon-open-file"></span></button>

                                                    <button ng-if="trabajo.estatus == 'TransResponsabilidad'" ng-hide="userData.idTipoUsuario == 4 || userData.idTipoUsuario == 3" class="btn btn-success" type="button" ng-click="datosEntradaCertificadoModal(trabajo.idTrabajo)" data-toggle="tooltip" tooltip="Generar certificado de conformidad" tooltip-placement="up"><span class="glyphicon glyphicon-file"></span></button>

                                                    <button ng-if="trabajo.estatus == 'CertificadoGenerado'" ng-hide="userData.idTipoUsuario == 3 || userData.idTipoUsuario == 4" class="btn btn-success" type="button" ng-click="adjuntar(trabajo.idTrabajo,5)" data-toggle="tooltip" tooltip="Cargar certificado de conformidad" tooltip-placement="up"><span class="glyphicon glyphicon-upload"></span></button>
                                                    
                                                    <a ng-if="trabajo.estatus == 'CertificadoCall'" ng-hide="userData.idTipoUsuario == 2 || userData.idTipoUsuario == 3" type="button" data-toggle="tooltip" tooltip="Descargar certificado de conformidad" tooltip-placement="up" href="{{vIpServer}}/uploads/files/{{trabajo.idTrabajo}}/certificadoConformidad/CertificadoConformidad.pdf" target="_parent" download="CeretificadoConformidad" class="btn btn-success" role="button" ng-click="descargaCertificadoConformidadPDF(trabajo.idTrabajo)"><span class="glyphicon glyphicon-download"></span></a>

                                                    <a ng-if="trabajo.estatus == 'CertificadoCall'" ng-hide="userData.idTipoUsuario == 2 || userData.idTipoUsuario == 3" type="button" data-toggle="tooltip" tooltip="Rechazar Trabajo" tooltip-placement="up" class="btn btn-cancela btn-danger btnTerminarTrabajo2" role="button" ng-click="openOrdenTrabajoModal(23, trabajo.idTrabajo)">&nbsp;<i class="fa fa-times"></i></a>  

                                                    <button ng-if="trabajo.estatus == 'CertificadoDescargado'" ng-hide="userData.idTipoUsuario == 2 || userData.idTipoUsuario == 3" class="btn btn-success" type="button" ng-click="adjuntar(trabajo.idTrabajo,6)" data-toggle="tooltip" tooltip="Cargar certificado de conformidad" tooltip-placement="left"><span class="glyphicon glyphicon-upload"></span></button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </tab>
                            <tab heading="Aprobado" index="2">
                                <br/>
                                <br/>
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered table-hover dataTableTrabajoAprobado" cg-busy="{promise:promise,message:message}">
                                        <thead>
                                            <tr>
                                                <th>Número económico</th>
                                                <th>TAR</th>
                                                <th>Marca</th>
                                                <th>Modelo</th>
                                                <th>Descripción</th>
                                                <th>Observaciones</th>
                                                <th>Estatus</th>
                                                <th>Fecha</th>
                                                <th>Acción</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="trabajo in trabajosAprobados">
                                                <td>{{trabajo.numEconomico}}</td>
                                                <td>{{trabajo.TAR}}</td>
                                                <td>{{trabajo.marca}}</td>
                                                <td>{{trabajo.modeloMarca}}</td>
                                                <td>{{trabajo.trabajo}}</td>
                                                <td>{{trabajo.observacion}}</td>
                                                <td>{{trabajo.descripcionLarga}}</td>
                                                <td>{{trabajo.fechaFin | date:"dd-MM-yy HH:mm"}}</td>
                                                <td>
                                                    <button class="btn btn-info" type="button" ng-click="aprobarTrabajo(trabajo, 1)" data-toggle="tooltip" tooltip="Ver órden de servicio" tooltip-placement="up"><span class="glyphicon glyphicon-sunglasses"></span></button>

                                                    <button ng-if="trabajo.estatus == 'Cerrado'" ng-hide="userData.idTipoUsuario == 2 || userData.idTipoUsuario == 4" class="btn btn-success" type="button" ng-click="adjuntar(trabajo.idTrabajo,3)" data-toggle="tooltip" tooltip="Cargar factura" tooltip-placement="up"><span class="glyphicon glyphicon-upload"></span> </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </tab>
                        </tabset>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal inmodal" id="finalizarTrabajoModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Terminar trabajo</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <textarea placeholder="Observaciones" class="form-control" rows="4" ng-model="observacionTrabajo"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">Salir</button>
                <button type="button" class="btn btn-danger btnTerminarTrabajo">Terminar trabajo</button>
            </div>
        </div>
    </div>
</div>

<div id="factura" class="modal inmodal fade" role="dialog">
    <div class="modal-dialog modal-lg">

        <!-- Modal content-->
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Carga de Archivo</h4>
            </div>
            <div class="modal-body">
                <div class="table-responsive m-t" style="margin-left:10%">
                    <iframe src="/AngularJS/Templates/uploader.html" width="680px" height="380px" frameborder="0" id="uploader" scrolling="no"></iframe>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal" ng-click="cargaArchivosEspeciales()">Adjuntar</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="datosEntradaCertificadoModal" class="modal inmodal fade" role="dialog">
    <div class="modal-dialog modal-md">

        <!-- Modal content-->
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Datos de entrada del Certificado de conformidad</h4>
            </div>
            <div class="modal-body">
                <div class="table-responsive m-t">
                    <form role="form">
                        <div class="form-group">
                            <input type="text" placeholder="Número de reporte" class="form-control" ng-model="certificadoParams.noReporte">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Region" class="form-control" ng-model="certificadoParams.gerencia">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="TAD" class="form-control" ng-model="certificadoParams.tad">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Solpe" class="form-control" ng-model="certificadoParams.solpe">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Orden de surtimiento" class="form-control" ng-model="certificadoParams.ordenSurtimiento">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Monto OS" ng-model="certificadoParams.montoOS" class="form-control">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Pedido asociado" class="form-control" ng-model="certificadoParams.pedidoAsociado">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Nombre del emisor" class="form-control" ng-model="certificadoParams.nombreEmisor">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Nombre del proveedor" class="form-control" ng-model="certificadoParams.nombreProveedor">
                        </div>
                        <div class="form-group">
                            <input type="text" placeholder="Puesto del proveedor" class="form-control" ng-model="certificadoParams.puestoProveedor">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" ng-click="generaCertificadoConformidadPDF()">Generar certificado</button>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal inmodal" id="finalizarTrabajoModal2" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInY">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">Rechazar trabajo</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <textarea placeholder="Observaciones" class="form-control" rows="4" ng-model="observacionRechazo"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-white" data-dismiss="modal">Salir</button>
                <button type="button" class="btn btn-danger btnTerminarTrabajo2">Rechzar trabajo</button>
            </div>
        </div>
    </div>
</div>